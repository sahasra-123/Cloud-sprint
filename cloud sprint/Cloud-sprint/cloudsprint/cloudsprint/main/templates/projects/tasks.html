<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CloudSprint - Tasks for {{ project.name }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <header>
        <h1>CloudSprint</h1>
        <div>
            <span>Welcome, {{ session.username }}!</span>
            <a href="{{ url_for('profile') }}">Profile</a>
            <a href="{{ url_for('logout') }}">Logout</a>
        </div>
    </header>
    <nav>
        <a href="{{ url_for('dashboard') }}">Dashboard</a>
        <a href="{{ url_for('projects') }}">Projects</a>
        <a href="{{ url_for('meetings') }}">Meetings</a>
        <a href="{{ url_for('notifications') }}">Notifications</a>
        <a href="{{ url_for('chat') }}">Team Chat</a>
        {% if session.is_admin %}
            <a href="{{ url_for('admin_dashboard') }}">Admin Dashboard</a>
        {% endif %}
    </nav>
    <div class="container">
        <h2>Tasks for Project: {{ project.name }}</h2>
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }}">{{ message }}</div>
                {% endfor %}
            {% endif %}
        {% endwith %}
        
        <h3>Add New Task</h3>
        <form method="POST" action="{{ url_for('project_tasks', project_id=project.id) }}">
            <label for="title">Title:</label>
            <input type="text" id="title" name="title" required>
            
            <label for="description">Description:</label>
            <textarea id="description" name="description"></textarea>
            
            <label for="status">Status:</label>
            <select id="status" name="status" required>
                <option value="Not Started">Not Started</option>
                <option value="In Progress">In Progress</option>
                <option value="On Hold">On Hold</option>
                <option value="Completed">Completed</option>
            </select>
            
            <label for="deadline">Deadline:</label>
            <input type="date" id="deadline" name="deadline" required>
            
            <label for="category_id">Category:</label>
            <select id="category_id" name="category_id" required>
                {% for category in categories %}
                    <option value="{{ category.id }}">{{ category.name }}</option>
                {% endfor %}
            </select>
            
            <label for="assigned_to">Assign To:</label>
            <select id="assigned_to" name="assigned_to">
                <option value="">Unassigned</option>
                {% for member in team_members %}
                    <option value="{{ member.id }}">{{ member.username }}</option>
                {% endfor %}
            </select>
            
            <button type="submit">Add Task</button>
        </form>
        
        <h3>Task List</h3>
        {% if tasks %}
            <table>
                <thead>
                    <tr>
                        <th>Title</th>
                        <th>Status</th>
                        <th>Deadline</th>
                        <th>Category</th>
                        <th>Assigned To</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for task in tasks %}
                        <tr>
                            <td>{{ task.title }}</td>
                            <td>{{ task.status }}</td>
                            <td>{{ task.deadline.strftime('%Y-%m-%d') }}</td>
                            <td>{{ task.category.name }}</td>
                            <td>{{ task.assigned_to.username if task.assigned_to else 'Unassigned' }}</td>
                            <td>
                                <a href="{{ url_for('task_details', task_id=task.id) }}">View</a>
                                <a href="{{ url_for('edit_task', task_id=task.id) }}">Edit</a>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p>No tasks found.</p>
        {% endif %}
    </div>
</body>
</html>